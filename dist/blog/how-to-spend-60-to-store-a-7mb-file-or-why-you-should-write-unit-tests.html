
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>How to Spend $60 to Store a 7mb File - Or Why You Should Write Unit Tests| @polluterofminds</title>
	<link rel="stylesheet" href="/assets/styles.css">
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta name="description" content="A blog by Justin Hunter">
  <meta property="og:title" content="How to Spend $60 to Store a 7mb File - Or Why You Should Write Unit Tests" />
  <meta property="og:site_name" content="@polluterofminds" />
  <meta property="og:description" content="A blog by Justin Hunter" />
  <meta property="og:image" content="https://pinata-tutorials.mypinata.cloud/ipfs/QmVJhZCEabf3BG35yzD482rNgstwsHq6QnTStdGimsUAdy" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@polluterofminds" />
  <meta name="twitter:title" content="How to Spend $60 to Store a 7mb File - Or Why You Should Write Unit Tests" />
  <meta name="twitter:description" content="A blog by Justin Hunter" />
  <meta name="twitter:image" content="https://pinata-tutorials.mypinata.cloud/ipfs/QmVJhZCEabf3BG35yzD482rNgstwsHq6QnTStdGimsUAdy" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://pinata-tutorials.mypinata.cloud/ipfs/Qmc6hsZzaAkWkHdvR13nj1a9esJ6CdwrXM61xk17nVDkvf">
  <link rel="icon" type="image/png" sizes="16x16" href="https://pinata-tutorials.mypinata.cloud/ipfs/QmWNGerHrw8o8hH5PJokYjHdEZbEJ2UAiYBA2mMTkUpsuc">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-950 text-white font-sans w-4/5 md:w-3/4 m-auto">
  
  <header class="py-6 flex justify-between w-full items-center">
    <div>
      <a href="/">
        <h3 class="text-xl">@polluterofminds</h3>
      </a>
    </div>
    <div class="md:flex md:inline hidden">
      <a class="px-2" href="/blog">Blog</a>
      <a class="px-2" href="/tags">Tags</a>
      <a class="px-2" href="/projects">Projects</a>
      <a class="px-2" href="/about">About</a>
    </div>
    <nav class="md:hidden" aria-label="nav button" role="navigation">
      <div id="menuToggle">
        <input name="nav" id="nav" type="checkbox"/>
        <span></span>
        <span></span>
        <span></span>
        <ul id="menu">
          <a href="/blog">
            <li>Blog</li>
          </a>
          <a href="/tags">
            <li>Tags</li>
          </a>
          <a href="/projects">
            <li>Projects</li>
          </a>
          <a href="/about">
            <li>About</li>
          </a>
          <a href="/search">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
            </svg>
          </a>
        </ul>
      </div>
    </nav>
  </header>

  <article>
        <div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700">
          <header class="pt-6 xl:pb-6">
            <div class="space-y-1 text-center">
              <dl class="space-y-10">
                <div>
                  <dt class="sr-only">Published on</dt>
                  <dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400">
                    <time dateTime=2020-11-18 15:33:55 +0000 UTC>
                      Nov 18, 2020
                    </time>
                  </dd>
                </div>
              </dl>
              <div>
                <h3 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">How to Spend $60 to Store a 7mb File - Or Why You Should Write Unit Tests</h3>
              </div>
            </div>
          </header>
          <div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0">
            <dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700">
              <dt class="sr-only">Authors</dt>
              <dd>
                <ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8">
                  
                    <li class="flex items-center space-x-2" key=Justin Hunter>                      
                        <img
                          src=/assets/me.jpg           
                          alt="avatar"
                          class="h-10 w-10 rounded-full"
                        />
                      
                      <dl class="whitespace-nowrap text-sm font-medium leading-5">
                        <dt class="sr-only">Name</dt>
                        <dd class="text-gray-900 dark:text-gray-100">Justin Hunter</dd>
                        <dt class="sr-only">Twitter</dt>
                        <dd>
                          <a
                            href=https://twitter.com/polluterofminds
                            target="_blank"
                            rel="noopener noreferrer"
                            class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
                            >
                            @polluterofminds
                          </a>
                        </dd>
                        
                      </dl>
                    </li>
                </ul>
              </dd>
            </dl>                        
            <div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0">
              <div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><p>I'm not the best at writing automated tests. Sometimes I write them as I go, sometimes I write them before checking my code in, and sometimes I don't write them at all. This is bad practice, and I acknowledge it's an area where I need to improve. And today, I'll walk you through exactly why you shouldn't be like me.</p>

<p>A little background first:</p>

<p>I'm working on a project for my company, <a href="https://pinata.cloud/">Pinata</a>, where we interact with the <a href="https://filecoin.io/">Filecoin</a> blockchain. Filecoin works as an open-market, long-term storage solution for content. Unlike using a service like Amazon S3 Glacier, you can search for a storage provider (called miners) with rates you like and choose that provider to store your content for an agreed amount period of time. At the time of this writing, the minimum amount of time a storage deal can be made for is about six months.</p>

<p>As part of the process for finding storage providers and proposing a &quot;contract&quot; to store the content, it is important (to us at least) to convert the cost of storage to USD. However, the conversion is not exactly straight forward.</p>

<p>Storage providers provide quotes for storage in a format called AttoFil. This is the smallest denomination of the Filecoin currency called FIL. One AttoFil is 10^-18 FIL. The quoted price is also for a single epoch of time (approximately 30 seconds) and is per GB. So for example, if someone quoted <code>500000000</code>, the calculation for cost in FIL for 30 seconds of storage would be:</p>

<p><code>
(500000000 * Math.pow(10, -18)
</code></p>

<p>That's pretty straight forward so far. But there are three additional variables missing in order to achieve our goal. We are storing content for about six months (In Epochs), we are not storing exactly one GB each time, and we need to know that we are not overpaying in USD.</p>

<p>The first step was to calculate the current cost of FIL in USD. That's pretty easy. As of right now, the price of one FIL is $28.48. Next, we need to figure out what the cost of one AttoFil is in USD. To do that, we take <code>28.48 * Math.pow(10, -18)</code>. Next, we need to figure out the size of our file to store in bytes and convert that to GB. There are many ways to do this, but for simplicity, the calculation is essentially this:</p>

<p><code>
const sizeInKb = FileSize/1024;
const sizeInMb = sizeInKb/1024;
const sizeInGb = sizeInMb/1024;
</code></p>

<p>Now, we need to calculate how many epochs (30 second periods of time) there are in six months. I'll save you the math and tell you it's about 518400 epochs.</p>

<p>With all of this information, the trick is calculating the right price to propose to the storage provider. There's no going back if they accept the proposal...even if you mess up and overpay. And that's exactly what happened to me.</p>

<p>I did not have a unit test in place to verify the price we would be paying did not exceed the price in USD we were comfortable with for six months of storage for any given file size. Because of this, I happened to query a storage provider who quoted a verify high price and a bug in my code missed the verification calculation. So, we ended up paying $60 to store a file that was about 7MB for six months.</p>

<p>The moral of this story is test, test, test.</p>
</div>
              <div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300">
                <a href="https://warpcast.com/~/compose?text=https://polluterofminds/blog/how-to-spend-60-to-store-a-7mb-file-or-why-you-should-write-unit-tests&embeds" rel="nofollow">
                  Discuss on Warpcast
                </a>      
              </div>
            </div>
            <footer>
              <div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y">
     
                <div class="py-4 xl:py-8">
                    <h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                      Tags
                    </h2>
                    <div class="flex flex-wrap">
                      
                        <a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/dev">
                          dev
                        </a>
                      
                    </div>
                  </div>
              </div>
              <div class="pt-4 xl:pt-8">
                <a
                  href="/"
                  class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
                  aria-label="Back to the blog"
                >
                  &larr; Back to the blog
                </a>
              </div>
            </footer>
          </div>
        </div>
      </article>
    </div>
    
    <footer>
      <div class="mt-16 flex flex-col items-center">
        <div class="mb-3 flex space-x-4">
          <a
            class="text-sm text-gray-500 transition hover:text-gray-600"
            target="_blank"
            rel="noopener noreferrer"
            href="mailto:justin@polluterofminds.com"
            aria-label="Email"
          >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
              </svg>
            </a>
            <a
              class="text-sm text-gray-500 transition hover:text-gray-600"
              target="_blank"
              rel="noopener noreferrer"
              href="https://github.com/polluterofminds"
              aria-label="Github"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8">
                <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
              </svg>
            </a>
            <a
              class="text-sm text-gray-500 transition hover:text-gray-600"
              target="_blank"
              rel="noopener noreferrer"
              href="https://www.linkedin.com/in/justin-hunter-b30a1b80/"
              aria-label="LinkedIn"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
              </svg>
            </a>
            <a
              class="text-sm text-gray-500 transition hover:text-gray-600"
              target="_blank"
              rel="noopener noreferrer"
              href="https://twitter.com/polluterofminds"
              aria-label="Twitter"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path>
              </svg>
            </a>
            <a
              class="text-sm text-white transition hover:text-gray-600"
              target="_blank"
              rel="noopener noreferrer"
              href="https://warpcast.com/polluterofminds"
              aria-label="Warpcast"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-7 w-7">
                <path d="M23.2 22.2857C23.642 22.2857 24 22.6693 24 23.1429V24H16V23.1429C16 22.6693 16.358 22.2857 16.8 22.2857H23.2Z" fill="currentColor"/>
                <path d="M23.2 22.2857V21.4286C23.2 20.955 22.842 20.5714 22.4 20.5714H17.6C17.158 20.5714 16.8 20.955 16.8 21.4286L16.8 22.2857H23.2Z" fill="currentColor"/>
                <path d="M20 0H4V3.42857H20V0Z" fill="currentColor"/>
                <path d="M20 2.57143H4V3.42857H20V2.57143Z" fill="currentColor"/>
                <path d="M23.2 6.85714H0.8L0 3.42857H24L23.2 6.85714Z" fill="currentColor"/>
                <path d="M22.4 6.85714H17.6L17.6 20.5714H22.4V6.85714Z" fill="currentColor"/>
                <path d="M7.2 22.2857C7.642 22.2857 8 22.6693 8 23.1429V24H0V23.1429C0 22.6693 0.358 22.2857 0.8 22.2857H7.2Z" fill="currentColor"/>
                <path d="M7.2 22.2857V21.4286C7.2 20.955 6.842 20.5714 6.4 20.5714H1.6C1.158 20.5714 0.800001 20.955 0.800001 21.4286L0.8 22.2857H7.2Z" fill="currentColor"/>
                <path d="M6.4 6.85714H1.6L1.6 20.5714H6.4L6.4 6.85714Z" fill="currentColor"/>
                <path d="M6.4 13.6457C6.4 10.332 8.9072 7.64572 12 7.64572C15.0928 7.64572 17.6 10.332 17.6 13.6457V5.07429H6.4V13.6457Z" fill="currentColor"/>
              </svg>
            </a>
        </div>
        <div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <div>Justin Hunter</div>
          <div> • </div>                    
          <a class="ml-2" href="/">@polluterofminds</a>
        </div>
        <div class="mb-8 text-sm text-gray-500 dark:text-gray-400">
    
        </div>
      </div>
    </footer>

</body>
</html>